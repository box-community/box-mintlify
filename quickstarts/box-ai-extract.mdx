---
title: Data Extraction
---

One of the most powerful features of Box AI is the ability to extract key/value pairs
from documents in Box through a single API call. This quickstart guide will walk you 
through the steps to set up the Box SDK, create a metadata template, upload a file, 
and extract data using Box AI.

In this quick start guide, we will walk you through the process from creating an app 
through the extraction of data and pushing that data back to Box as metadata.

<Steps>
  <Step title="Create and configure a Box application">
    The first step for any Box Platform integration is to create and configure a Box 
    application. We do this in the [Box Developer Console](https://app.box.com/developers/console). 

    For this quickstart, we will create an App with the `Client Credentials Grant` 
    application type. Once the app is created, be sure to enable the following scopes:
    * Read all files and folders stored in Box
    * Write all files and folders stored in Box
    * Manage AI


    [This guide](/guides/getting-started/first-application#create-your-first-application) 
    will help you create a new Box application.
  </Step>
  <Step title="Create a Metadata Template">
    <Tip>
      This step requires Admin access to your Box Enterprise. If you do note have access,
      in your current environment, you can create a Free Developer account at 
      https://developer.box.com/signup/developer.
    </Tip>

    Box AI offers a few ways to extract data from documents:
    Type | Description | When to choose
    ---|---|---
    Freeform | Takes a string prompt | great if you want natural language prompts
    Structured with Template| Takes a Metadata Template Key | Define fields and data types once. Also makes pushing back into Box as Metadata easy.
    Structured with fields | Takes a JSON array of fields | Great for one-off extractions without needing to create a template.
    Enhanced Extract Agent | Uses a specialized agent with a reasoning model | Great for complex documents or more nuanced extraction. Works with Structured with Templates or fields.

    For this quickstart, we will create a Metadata Template to define the fields we want
    to extract from our documents. This [guide](https://support.box.com/hc/en-us/articles/360044194033-Customizing-Metadata-Templates) 
    will walk you through the steps to create a Metadata Template in the Box Admin 
    Console.

    Give your template a name. In this tutorial, we will use "Box AI extract quickstart".

    We will create the following fields:
    Field name | Field type | Field Description
    ---|---|---
    Client Name | Text | The name of the client receiving the invoice
    Invoice Amount | Number | The total amount of the invoice after taxes and fees
    Products | Text | The name of the products delivered in the invoice. Return these as a comma-delimited string.

    <Tip>
      The field description is used by Box AI to supplement the prompt to the LLM to ensure the 
      right data is extracted. Use this to your advantage.
    </Tip>

    Click "Save" to create your template. Make note of the Template Key, as we will need it 
    in a later step. When you save the Template, you will see the list of templates. To find the Template Key, 
    open the template you just created and inspect the URL. The last part of the path is 
    your template key. As an example, the URL might look like this:
    `https://app.box.com/master/metadata/templates/boxAiExtractQuickstart`.
    
    In this case, the Template Key is `boxAiExtractQuickstart`.

  </Step>
  <Step title="Upload file">
    Now we need a file to test. We will be using this 
    [sample invoice document](/static/quickstarts/extract/files/demo-invoice-20tax-2.pdf).

    Download this file and drag and drop it into your Box account. 

    We will need the file ID for this demo. To get the file ID, open the file in Box and inspect 
    the URL. The last part of the path is your file ID. As an example, the URL might look like this:
    `https://app.box.com/file/2064123286902`
    
    In this case, the file ID is `2064123286902`.
  </Step>
  <Step title="Configure environment">
    Now we need to set up our development environment. For this quickstart, we will be using Python and the 
    Box Python SDK version 10. Make sure you have Python 3.11 or higher installed on your machine.
    1. Create a new directory for your project and navigate into it.
    2. Create a virtual environment:
       ```bash
       python3 -m venv .venv
       source venv/bin/activate
       ```
    3. Install the Box Python SDK:
       ```bash
       pip install boxsdk~=10
       ```
    4. Install the `python-dotenv` package to load environment variables from the `.env` file:
       ```bash
       pip install python-dotenv
       ```
    5. Create a `.env` file in the root of your project directory and add the following 
    environment variables, replacing the placeholder values with your actual Box app credentials
    and the IDs from the previous steps:
       ```bash
        BOX_DEVELOPER_TOKEN=your_box_developer_token

        BOX_METADATA_TEMPLATE_KEY=your_metadata_template_key
        BOX_FILE_ID=your_box_file_id
       ```
    
    To get your Developer Token, go to the Box Developer Console, open your app, and navigate to 
    the `Configuration` tab. Click on `Generate Developer Token` to create a new token.   

  </Step>
  <Step title="Create extract.py">
    Now we are ready to create our Python script to extract data from the document using Box AI. 
    
    Create a new file named `extract.py` in the root of your project directory and add the following code:

    ```python
    import os

    from dotenv import load_dotenv

    from box_sdk_gen import (
        AiItemBase,
        BoxClient,
        BoxDeveloperTokenAuth,
        CreateAiExtractStructuredMetadataTemplate,
        CreateAiExtractStructuredMetadataTemplateTypeField,
        CreateFileMetadataByIdScope
    )

    load_dotenv()

    developer_token = os.getenv("BOX_DEVELOPER_TOKEN")
    file_id = os.getenv("BOX_FILE_ID")
    template_key = os.getenv("BOX_METADATA_TEMPLATE_KEY")

    def get_box_client(token: str) -> BoxClient:
        
        if not developer_token:
            raise ValueError("BOX_DEVELOPER_TOKEN is not set in environment variables.")
        
        auth = BoxDeveloperTokenAuth(token=token)
        client = BoxClient(auth=auth)

        return client

    def main():
        client = get_box_client(token=developer_token)

        me = client.users.get_user_me()
        print(f"My user ID is {me.id}")


    if __name__ == "__main__":
        main()
    ```

    In this code, we load the environment variables from the `.env` file, initialize the Box SDK client, 
    and print the current user's ID to validate that the client is working correctly.

    To run the script, execute the following command in your terminal:

    ```bash
    python extract.py
    ```

    You should see your user ID printed in the console, indicating that the Box SDK client is set up correctly.

    ```bash
    My user ID is 123456789
    ```

  </Step>
  <Step title="Extract data">
    Now that we have a working Box SDK client, we can add the code to extract data from the document using Box AI.

    Between the `get_box_client` function and the `main` function, add the following functions:

    ```python
    def extract_metadata(client: BoxClient, file_id: str, template_key: str) -> dict:
        metadata = client.ai.create_ai_extract_structured(
            [AiItemBase(id=file_id)],
            metadata_template=CreateAiExtractStructuredMetadataTemplate(
                template_key=template_key,
                type=CreateAiExtractStructuredMetadataTemplateTypeField.METADATA_TEMPLATE,
                scope="enterprise",
            ),
        )
        
        return metadata.to_dict()['answer']
    ```

    This function uses the Box AI `create_ai_extract_structured` method to extract metadata from the specified file. 
    We must pass the function our BoxClient, the file ID, and the metadata template key we created earlier. The 
    function returns the extracted metadata as a dictionary.

    Now let's add the function call to extract the metadata in the `main` function. The new `main` function should 
    look like this:

    ```python
    def main():
        client = get_box_client(token=developer_token)

        me = client.users.get_user_me()
        print(f"My user ID is {me.id}")

        metadata = extract_metadata(client=client, file_id=file_id, template_key=template_key)

        print(f"Extracted Metadata: {metadata}")
    ```

    The SDK will handle the API call to Box AI and return the extracted metadata as an 
    [`AiExtractStructuredResponse`](/reference/resources/ai-extract-structured-response) object. In our code, 
    we convert this  object to a dictionary and return the `answer` field, which contains the extracted 
    key/value pairs.

    We will print out the extracted metadata to the console to verify that the extraction was successful.

    To run the script, execute the following command in your terminal:

    ```bash
    python extract.py
    ```

    You should see your user ID printed in the console, indicating that the Box SDK client is set up correctly.

    ```bash
    My user ID is 123456789

    Extracted Metadata: {'clientName': 'ACME Inc', 'invoiceAmount': 1106.06, 'products': 'Polyol, Diisocyanate, 
    Carbon Dioxide, Laser, Lens, Oleic Acid, Glycerine, Sodium Tallowate, Paint Base, Polypropylene, Rubber, 
    Additive, Pigment, Aluminum Silicate, Magnesium Silicate, Zinc Oxide, Distilled Solvent, Petroleum Distillate, 
    Sulfur Dioxide, Sodium Benzoate, Dust cap, Ferrite cap, Cone and coil assembly, Cleaner, Polypropylene pellets, 
    Polypropylene chips, Polypropylene blocks, Polypropylene slag, Parts Wash Solvent, Jar, 
    Plastic Bottle - 15.2 FL Oz (450 ml), Polymer'}
    ```
  </Step>
  <Step title="Add Metadata to file">
    Now that we have extracted the metadata from the document, you have key value pairs that you can use in your application.
    With this data, you can push to a database, pass to an LLM or agent for further processing, add the data to a CRM, 
    or any number of other use cases.

    In this quickstart, we will push the extracted metadata back to Box as file metadata using the Box SDK. Box Metadata 
    is a powerful tool for organizing and managing your files in Box. With Box Apps, you can create dashboards and reports 
    based on this information. When viewing the file in Box, the metadata can display key insights about the document at a glance. 
    Both in the end user application and via API, you can filter and search based on metadata values in a powerful way. Want to 
    see all invoices that are over $500 that were submitted in the last 30 days? Metadata Query can give you that answer.

    To push the extracted metadata back to Box, add the following function between the `extract_metadata` function
    and the `main` function:

    ```python
    def push_metadata(client: BoxClient, file_id: str, metadata: dict, template_key: str) -> dict:
        attached_metadata = client.file_metadata.create_file_metadata_by_id(
            file_id,
            CreateFileMetadataByIdScope.ENTERPRISE,
            template_key,
            metadata,
        )
        return attached_metadata.to_dict()
    ```

    This function uses the `create_file_metadata_by_id` method to attach metadata to the specified file. 
    We pass in the BoxClient, file ID, metadata dictionary, and template key. The API itself returns a 
    [`MetadataFull`](/reference/resources/metadata--full) object. The function converts this object to a 
    dictionary and returns it.

    Now let's add the function call to push the metadata in the `main` function. The updated `main` function 
    should look like this:

    ```python
    def main():
        client = get_box_client(token=developer_token)

        me = client.users.get_user_me()
        print(f"My user ID is {me.id}")

        metadata = extract_metadata(client=client, file_id=file_id, template_key=template_key)

        print(f"Extracted Metadata: {metadata}")

        attached_metadata = push_metadata(client=client, file_id=file_id, metadata=metadata, template_key=template_key)

        print(f"Attached Metadata: {attached_metadata}")
    ```

    To run the script, execute the following command in your terminal:

    ```bash
    python extract.py
    ```

    You should see your user ID printed in the console, indicating that the Box SDK client is set up correctly.

    ```bash
    My user ID is 123456789
    
    Extracted Metadata: {'clientName': 'ACME Inc', 'invoiceAmount': 1106.06, 'products': 'Polyol, Diisocyanate, 
    Carbon Dioxide, Laser, Lens, Oleic Acid, Glycerine, Sodium Tallowate, Paint Base, Polypropylene, Rubber, 
    Additive, Pigment, Aluminum Silicate, Magnesium Silicate, Zinc Oxide, Distilled Solvent, Petroleum Distillate, 
    Sulfur Dioxide, Sodium Benzoate, Dust cap, Ferrite cap, Cone and coil assembly, Cleaner, Polypropylene pellets, 
    Polypropylene chips, Polypropylene blocks, Polypropylene slag, Parts Wash Solvent, Jar, 
    Plastic Bottle - 15.2 FL Oz (450 ml), Polymer'}

    Attached Metadata: {'invoiceAmount': 1106.06, 'products': 'Polyol, Diisocyanate, Carbon Dioxide, Laser, Lens, 
    Oleic Acid, Glycerine, Sodium Tallowate, Paint Base, Polypropylene, Rubber, Additive, Pigment, Aluminum Silicate, 
    Magnesium Silicate, Zinc Oxide, Distilled Solvent, Petroleum Distillate, Sulfur Dioxide, Sodium Benzoate, Dust cap, 
    Ferrite cap, Cone and coil assembly, Cleaner, Polypropylene pellets, Polypropylene chips, Polypropylene blocks, 
    Polypropylene slag, Parts Wash Solvent, Jar, Plastic Bottle - 15.2 FL Oz (450 ml), Polymer', 
    'clientName': 'ACME Inc', '$parent': 'file_1956534287859', '$template': 'boxAiExtractQuickstart', 
    '$scope': 'enterprise_899905961', '$version': 0, '$canEdit': True, '$id': '4d4f0b55-d45a-4ba4-9ff6-1241182cb76a', 
    '$type': 'boxAiExtractQuickstart-c4024235-2384-49f4-9286-ada6d68fd6a9', '$typeVersion': 0, 'extra_data': 
    {'invoiceAmount': 1106.06, 'products': 'Polyol, Diisocyanate, Carbon Dioxide, Laser, Lens, Oleic Acid, Glycerine, 
    Sodium Tallowate, Paint Base, Polypropylene, Rubber, Additive, Pigment, Aluminum Silicate, Magnesium Silicate, 
    Zinc Oxide, Distilled Solvent, Petroleum Distillate, Sulfur Dioxide, Sodium Benzoate, Dust cap, Ferrite cap, 
    Cone and coil assembly, Cleaner, Polypropylene pellets, Polypropylene chips, Polypropylene blocks, Polypropylene slag, 
    Parts Wash Solvent, Jar, Plastic Bottle - 15.2 FL Oz (450 ml), Polymer', 'clientName': 'ACME Inc'}}
    ```
  </Step>
</Steps>

## Resources
- [Final code](https://github.com/box-community/box-ai-extract-quickstart)
- [Extract Structured Metadata API Reference](/reference/post-ai-extract-structured)
- [Create metadata instance on file](/reference/post-files-id-metadata-id-id)
- [Box SDK for Python](https://github.com/box/box-python-sdk/tree/main)